{"version":3,"file":"settings.js","sources":["../../../../resources/js/modules/bootstrap/components/ListGroup.vue","../../../../resources/js/modules/bootstrap/components/ListGroupItem.vue","../../../../resources/js/tiers/admin/components/SettingField.vue","../../../../resources/js/tiers/admin/apps/Settings.vue","../../../../resources/js/tiers/admin/startup/Settings.ts"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { computed } from \"vue\";\r\n\r\ndefineOptions({\r\n  inheritAttrs: false,\r\n});\r\n\r\ntype Props = {\r\n  type?: \"items\" | \"orders\" | \"actions\";\r\n  flush?: boolean;\r\n  horizontal?: boolean;\r\n};\r\nconst { type = \"items\", flush = false, horizontal = false } = defineProps<Props>();\r\n\r\nconst tag = computed(() =>\r\n  type === \"actions\" ? \"div\" : type === \"orders\" ? \"ol\" : \"ul\"\r\n);\r\n</script>\r\n<template>\r\n  <component\r\n    :is=\"tag\"\r\n    class=\"list-group\"\r\n    :class=\"{\r\n      'list-group-numbered': tag === 'ol',\r\n      'list-group-flush': flush,\r\n      'list-group-horizontal': horizontal,\r\n    }\"\r\n    v-bind=\"$attrs\"\r\n  >\r\n    <slot></slot>\r\n  </component>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { ListGroupColor } from \"../types\";\r\nimport { getCurrentInstance, computed } from 'vue';\r\n\r\ndefineOptions({\r\n  inheritAttrs: false,\r\n});\r\n\r\ntype Props = {\r\n  active?: boolean;\r\n  disabled?: boolean;\r\n  color?: ListGroupColor;\r\n};\r\nconst {\r\n  active = false,\r\n  disabled = false,\r\n  color = \"light\",\r\n} = defineProps<Props>();\r\n\r\nconst instance = getCurrentInstance();\r\nconst parentTag = computed(\r\n  () => instance?.parent?.props?.type?.toString?.()?.toLowerCase?.() ?? null\r\n);\r\n\r\nconst clickable = computed(() => parentTag.value === 'actions')\r\n\r\n</script>\r\n<template>\r\n  <component\r\n    :is=\"clickable ? 'a' : 'li'\"\r\n    :href=\"clickable ? '#' : null\"\r\n    class=\"list-group-item\"\r\n    :class=\"{\r\n      'list-group-item-action': clickable,\r\n      [`list-group-item-${color}`]: true,\r\n      active,\r\n      disabled,\r\n    }\"\r\n    :aria-current=\"active ? 'true' : undefined\"\r\n    :aria-disabled=\"disabled ? 'true' : undefined\"\r\n    @click.prevent\r\n    v-bind=\"$attrs\"\r\n  >\r\n    <slot></slot>\r\n  </component>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { SettingsCategory, SettingsItem } from \"@/lib/metadata\";\r\nimport AttributesInput from \"@/modules/form/components/AttributesInput.vue\";\r\nimport { createModel } from \"@/modules/form/hooks/model\";\r\nimport { Field } from \"@/modules/form/lib/field\";\r\nimport { Model } from \"@/modules/form/lib/model\";\r\nimport AttrsInput from \"@/modules/form/components/AttrsInput.vue\";\r\nimport Button from \"@/modules/bootstrap/components/Button.vue\";\r\nimport { ref, onUnmounted } from \"vue\";\r\nimport Icon from \"@/components/Icon.vue\";\r\nimport { mdiFloppy } from \"@mdi/js\";\r\nimport { api } from \"@/lib/api\";\r\nimport { successToast } from \"@/modules/bootstrap/lib/toast\";\r\n\r\ntype Props = {\r\n  item: SettingsItem;\r\n  category: SettingsCategory;\r\n  value?: string;\r\n};\r\n\r\nconst { item, category, value = undefined } = defineProps<Props>();\r\n\r\nconst btn = ref<any>(null);\r\n\r\nclass Setting extends Model {\r\n  get item(): Field {\r\n    return this.field(item.key ?? `${category.name}.${item.name}`, item.label, value ?? item.defaultValue);\r\n  }\r\n\r\n  get rules(): any[] {\r\n    return [];\r\n  }\r\n}\r\n\r\nconst [model, newModel, destroyModel] = createModel(Setting);\r\n\r\nconst save = async () => {\r\n  const valid = await model.value?.validate();\r\n  if (valid) {\r\n    btn.value?.start?.();\r\n    api()\r\n      .post(\"/settings/system\", {\r\n        name: model.value?.item.name,\r\n        value: model.value?.item.value,\r\n      })\r\n      .then(() => {\r\n        successToast(item.label, \"Saved Successfully\");\r\n      })\r\n      .finally(() => {\r\n        btn.value?.stop?.();\r\n      });\r\n  }\r\n};\r\n\r\nnewModel();\r\n\r\nonUnmounted(() => {\r\n  destroyModel();\r\n});\r\n</script>\r\n<template>\r\n  <form @submit.prevent=\"save\">\r\n    <div class=\"mb-3\">\r\n      <AttrsInput\r\n        v-if=\"model\"\r\n        :type=\"item.type\"\r\n        :field=\"model.item\"\r\n        :attributes=\"item.attributes\"\r\n        :props=\"item.props\"\r\n        :icon=\"item.icon\"\r\n      >\r\n        <template #buttonAfter=\"{ field }\">\r\n          <Button type=\"submit\" ref=\"btn\" color=\"secondary\" outline>\r\n            <Icon :path=\"mdiFloppy\" />Save\r\n          </Button>\r\n        </template>\r\n      </AttrsInput>\r\n    </div>\r\n  </form>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Settings, SettingsCategory, settings } from \"@/lib/metadata\";\r\nimport ListGroup from \"@/modules/bootstrap/components/ListGroup.vue\";\r\nimport ListGroupItem from \"@/modules/bootstrap/components/ListGroupItem.vue\";\r\nimport { ref, computed, onMounted } from \"vue\";\r\nimport SettingField from \"../components/SettingField.vue\";\r\nimport { api } from \"@/lib/api\";\r\nimport ContentLoader from \"@/components/ContentLoader.vue\";\r\n\r\nconst settingsWithKey = settings()?.map?.((category) => {\r\n  category.items = category.items.map((item) => {\r\n    return { ...item, key: `${category.name}.${item.name}` };\r\n  });\r\n  return category;\r\n}) as Settings;\r\n\r\nconst setting = ref<Settings>(settingsWithKey);\r\nconst selected = ref<string | undefined>(setting.value?.at(0)?.name);\r\nconst list = ref<any>(null);\r\nconst loader = ref<any>(null);\r\n\r\nconst select = (category: SettingsCategory) => {\r\n  selected.value = category.name;\r\n};\r\n\r\nconst category = computed(() =>\r\n  setting.value?.find((category) => category.name === selected.value)\r\n);\r\n\r\nconst fetch = () => {\r\n  loader.value?.start?.();\r\n  api()\r\n    .get(\"/settings/system\")\r\n    .then(({ data }: any) => {\r\n      list.value = data.reduce((items, item) => {\r\n        items[item.name] = item.value;\r\n        return items;\r\n      }, {});\r\n      loadNotConfigured();\r\n    })\r\n    .finally(() => {\r\n      loader.value?.stop?.();\r\n    });\r\n};\r\n\r\nconst loadNotConfigured = () => {\r\n  if (!Object.is(list.value, null) && Array.isArray(setting.value)) {\r\n    const configured: Array<string> = [];\r\n    setting.value?.forEach((category) => {\r\n      category.items.forEach((item) => {\r\n        configured.push(`${category.name}.${item.name}`);\r\n      });\r\n    });\r\n    const items = Object.keys(list.value)\r\n      .filter((name: string) => !configured.includes(name))\r\n      .map((name: string) => {\r\n        return {\r\n          type: \"string\",\r\n          key: name,\r\n          name,\r\n          label: name,\r\n          defaultValue: list.value[name],\r\n        };\r\n      });\r\n    setting.value.push({\r\n      name: \"other\",\r\n      label: \"Others\",\r\n      items,\r\n    });\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  fetch();\r\n});\r\n</script>\r\n<template>\r\n  <pre>{{ typeof list }}</pre>\r\n  <ContentLoader v-if=\"Array.isArray(setting)\" ref=\"loader\" title=\"Settings\">\r\n    <div class=\"row\">\r\n      <div class=\"col-md-3\">\r\n        <ListGroup type=\"actions\">\r\n          <template v-for=\"category in setting\" :key=\"category.name\">\r\n            <ListGroupItem\r\n              :active=\"selected === category.name\"\r\n              @click=\"select(category)\"\r\n            >\r\n              {{ category.label }}\r\n            </ListGroupItem>\r\n          </template>\r\n        </ListGroup>\r\n      </div>\r\n      <div v-if=\"category\" class=\"col-md-9\">\r\n        <div class=\"display-6 mb-3\">{{ category.label }}</div>\r\n        <template\r\n          v-for=\"item in category.items\"\r\n          :key=\"`${category.name}-${item.name}`\"\r\n        >\r\n          <SettingField\r\n            v-if=\"!Object.is(list, null)\"\r\n            :item=\"item\"\r\n            :category=\"category\"\r\n            :value=\"list[`${item.key}`]\"\r\n          />\r\n        </template>\r\n      </div>\r\n    </div>\r\n  </ContentLoader>\r\n  <div v-else class=\"p-3 text-muted\">There are no settings</div>\r\n</template>\r\n","/**\n * Settings.vue Startup File\n *\n * @project tripoline\n * @company Codendot <https://codendot.com>\n * @author Jawdat Sobh <jawdat@codendot.com>\n * @since Thursday, August 17, 2023 at 11:34 AM GMT+3\n *\n */\n\nimport { createApp } from \"@/lib/app\"\nimport AppComponent from \"../apps/Settings.vue\"\nimport bootstrap from \"../bootstrap/Settings\"\n\nconst app = createApp(\"settings\", AppComponent)\nbootstrap(app)\napp.mount()\n"],"names":["tag","computed","__props","instance","getCurrentInstance","parentTag","_f","_e","_d","_c","_b","_a","clickable","btn","ref","Setting","Model","model","newModel","destroyModel","createModel","save","api","successToast","onUnmounted","settingsWithKey","settings","category","item","setting","selected","list","loader","select","fetch","data","items","loadNotConfigured","configured","name","onMounted","app","createApp","AppComponent"],"mappings":"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"}