{"version":3,"file":"login.js","sources":["../../../../resources/js/components/Login.vue","../../../../resources/js/tiers/admin/startup/Login.ts"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport Button from \"@/modules/bootstrap/components/Button.vue\";\r\nimport StringInput from \"@/modules/form/components/StringInput.vue\";\r\nimport { createModel } from \"@/modules/form/hooks/model\";\r\nimport { Field } from \"@/modules/form/lib/field\";\r\nimport { Model } from \"@/modules/form/lib/model\";\r\nimport { RequiredRule } from \"@/modules/form/rules/required\";\r\nimport { StringRule } from \"@/modules/form/rules/string\";\r\nimport { mdiAccount, mdiFormTextboxPassword, mdiSend } from \"@mdi/js\";\r\nimport { onMounted, onUnmounted, ref } from \"vue\";\r\nimport Icon from \"@/components/Icon.vue\";\r\nimport { api } from \"@/lib/api\";\r\nimport { metadata } from \"@/lib/metadata\";\r\nimport { isDark } from \"@/modules/theme\";\r\n\r\ntype Props = {\r\n  redirectUrl?: string;\r\n};\r\n\r\nconst { redirectUrl = \"\" } = defineProps<Props>();\r\n\r\nclass Login extends Model {\r\n  get username(): Field {\r\n    return this.field(\"username\", \"Username\", this.initData?.username ?? \"\");\r\n  }\r\n\r\n  get password(): Field {\r\n    return this.field(\"password\", \"Password\", this.initData?.password ?? \"\");\r\n  }\r\n\r\n  get rules(): any[] {\r\n    return [\r\n      [[this.username, this.password], StringRule],\r\n      [[this.username, this.password], RequiredRule],\r\n    ];\r\n  }\r\n}\r\nconst button = ref<any>(null);\r\n\r\nconst [model, newModel, destroyModel] = createModel(Login);\r\n\r\nconst login = () => {\r\n  model.value?.validate()?.then((valid: boolean) => {\r\n    if (valid) {\r\n      button.value?.start?.();\r\n      api()\r\n        .post(\"/login\", model.value?.data ?? {})\r\n        .then(({ data }: any) => {\r\n          if (data.code === 200) {\r\n            const form = document.createElement(\"form\");\r\n            form.name = \"login\";\r\n            form.method = \"POST\";\r\n            form.action = `${metadata()?.url?.self}/Login`;\r\n            form.style.visibility = \"hidden\";\r\n            form.style.width = \"0px\";\r\n            form.style.height = \"0px\";\r\n            form.style.overflow = \"hidden\";\r\n            form.style.opacity = \"0\";\r\n\r\n            const tokenInput = document.createElement(\"input\");\r\n            tokenInput.type = \"hidden\";\r\n            tokenInput.name = \"token\";\r\n            tokenInput.value = data.token;\r\n            form.appendChild(tokenInput);\r\n\r\n            const expireInput = document.createElement(\"input\");\r\n            expireInput.type = \"hidden\";\r\n            expireInput.name = \"expire\";\r\n            expireInput.value = data.expire;\r\n            form.appendChild(expireInput);\r\n\r\n            const redirectUrlInput = document.createElement(\"input\");\r\n            redirectUrlInput.type = \"hidden\";\r\n            redirectUrlInput.name = \"redirectUrl\";\r\n            redirectUrlInput.value = redirectUrl ?? \"\";\r\n            form.appendChild(redirectUrlInput);\r\n\r\n            document.body.appendChild(form);\r\n            form.submit();\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          model.value?.addRemoteErrors?.(err);\r\n        })\r\n        .finally(() => {\r\n          button.value?.stop?.();\r\n        });\r\n    }\r\n  });\r\n};\r\n\r\nonMounted(() => {\r\n  newModel();\r\n});\r\n\r\nonUnmounted(() => {\r\n  destroyModel();\r\n});\r\n</script>\r\n<template>\r\n  <form v-if=\"model\" @submit.prevent=\"login\" class=\"login-form\">\r\n    <div>\r\n      <StringInput :field=\"model.username\">\r\n        <template #before>\r\n          <Icon :path=\"mdiAccount\" :color=\"isDark() ? 'info' : 'primary'\" />\r\n        </template>\r\n      </StringInput>\r\n    </div>\r\n    <div>\r\n      <StringInput :field=\"model.password\" type=\"password\">\r\n        <template #before>\r\n          <Icon\r\n            :path=\"mdiFormTextboxPassword\"\r\n            :color=\"isDark() ? 'info' : 'primary'\"\r\n          />\r\n        </template>\r\n      </StringInput>\r\n    </div>\r\n    <div class=\"d-flex justify-content-center align-items-center\">\r\n      <Button\r\n        type=\"submit\"\r\n        color=\"primary\"\r\n        class=\"fw-bold w-100\"\r\n        spinner-color=\"light\"\r\n        ref=\"button\"\r\n      >\r\n        <Icon :path=\"mdiSend\" color=\"info\" />SIGN IN</Button\r\n      >\r\n    </div>\r\n  </form>\r\n</template>\r\n<style lang=\"scss\">\r\n@import \"@scss/config\";\r\n@import \"@scss/mixins/dark\";\r\n\r\n.login-form {\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 30px;\r\n  width: 100%;\r\n  background: rgba($white, 0.6);\r\n  padding: 20px;\r\n  border-radius: 15px;\r\n  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);\r\n  @include dark {\r\n    background: rgba($black, 0.6);\r\n  }\r\n  label {\r\n    color: $info;\r\n    font-weight: bold;\r\n  }\r\n  input {\r\n    height: 50px;\r\n  }\r\n  button {\r\n    height: 50px;\r\n  }\r\n}\r\n</style>\r\n","/**\n * Login.vue Startup File\n *\n * @project tripoline\n * @company Codendot <https://codendot.com>\n * @author Jawdat Sobh <jawdat@codendot.com>\n * @since Thursday, August 17, 2023 at 11:34 AM GMT+3\n *\n */\n\nimport { createApp } from \"@/lib/app\"\nimport AppComponent from \"../apps/Login.vue\"\nimport bootstrap from \"../bootstrap/Login\"\n\nconst app = createApp(\"login\", AppComponent)\nbootstrap(app)\napp.mount()\n"],"names":["Login","Model","_a","StringRule","RequiredRule","button","ref","model","newModel","destroyModel","createModel","login","_b","valid","api","_c","data","form","metadata","tokenInput","expireInput","redirectUrlInput","__props","err","onMounted","onUnmounted","app","createApp","AppComponent"],"mappings":"gkCAqBA,MAAMA,UAAcC,CAAM,CACxB,IAAI,UAAkB,OACpB,OAAO,KAAK,MAAM,WAAY,aAAYC,EAAA,KAAK,WAAL,YAAAA,EAAe,WAAY,EAAE,CACzE,CAEA,IAAI,UAAkB,OACpB,OAAO,KAAK,MAAM,WAAY,aAAYA,EAAA,KAAK,WAAL,YAAAA,EAAe,WAAY,EAAE,CACzE,CAEA,IAAI,OAAe,CACV,MAAA,CACL,CAAC,CAAC,KAAK,SAAU,KAAK,QAAQ,EAAGC,CAAU,EAC3C,CAAC,CAAC,KAAK,SAAU,KAAK,QAAQ,EAAGC,CAAY,CAAA,CAEjD,CACF,CACM,MAAAC,EAASC,EAAS,IAAI,EAEtB,CAACC,EAAOC,EAAUC,CAAY,EAAIC,EAAYV,CAAK,EAEnDW,EAAQ,IAAM,UAClBC,GAAAV,EAAAK,EAAM,QAAN,YAAAL,EAAa,aAAb,MAAAU,EAAyB,KAAMC,GAAmB,WAC5CA,KACFD,GAAAV,EAAAG,EAAO,QAAP,YAAAH,EAAc,QAAd,MAAAU,EAAA,KAAAV,GACAY,IACG,KAAK,WAAUC,EAAAR,EAAM,QAAN,YAAAQ,EAAa,OAAQ,CAAA,CAAE,EACtC,KAAK,CAAC,CAAE,KAAAC,KAAgB,SACnB,GAAAA,EAAK,OAAS,IAAK,CACf,MAAAC,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,KAAO,QACZA,EAAK,OAAS,OACdA,EAAK,OAAS,IAAGL,GAAAV,EAAAgB,EAAS,IAAT,YAAAhB,EAAY,MAAZ,YAAAU,EAAiB,IAAI,SACtCK,EAAK,MAAM,WAAa,SACxBA,EAAK,MAAM,MAAQ,MACnBA,EAAK,MAAM,OAAS,MACpBA,EAAK,MAAM,SAAW,SACtBA,EAAK,MAAM,QAAU,IAEf,MAAAE,EAAa,SAAS,cAAc,OAAO,EACjDA,EAAW,KAAO,SAClBA,EAAW,KAAO,QAClBA,EAAW,MAAQH,EAAK,MACxBC,EAAK,YAAYE,CAAU,EAErB,MAAAC,EAAc,SAAS,cAAc,OAAO,EAClDA,EAAY,KAAO,SACnBA,EAAY,KAAO,SACnBA,EAAY,MAAQJ,EAAK,OACzBC,EAAK,YAAYG,CAAW,EAEtB,MAAAC,EAAmB,SAAS,cAAc,OAAO,EACvDA,EAAiB,KAAO,SACxBA,EAAiB,KAAO,cACPA,EAAA,MAAQC,EAAA,aAAe,GACxCL,EAAK,YAAYI,CAAgB,EAExB,SAAA,KAAK,YAAYJ,CAAI,EAC9BA,EAAK,OAAO,CACd,CAAA,CACD,EACA,MAAOM,GAAQ,UACRX,GAAAV,EAAAK,EAAA,QAAA,YAAAL,EAAO,kBAAP,MAAAU,EAAA,KAAAV,EAAyBqB,EAAG,CACnC,EACA,QAAQ,IAAM,UACbX,GAAAV,EAAAG,EAAO,QAAP,YAAAH,EAAc,OAAd,MAAAU,EAAA,KAAAV,EAAqB,CACtB,EACL,EACD,EAGH,OAAAsB,EAAU,IAAM,CACLhB,GAAA,CACV,EAEDiB,EAAY,IAAM,CACHhB,GAAA,CACd,6+BCnFKiB,GAAMC,EAAU,QAASC,EAAY,EAE3CF,GAAI,MAAM"}