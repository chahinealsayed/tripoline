{"version":3,"file":"app.js","sources":["../../../../resources/js/lib/private.ts","../../../../resources/js/lib/event-dispatcher.ts","../../../../resources/js/lib/base.ts","../../../../resources/js/lib/pinia.ts","../../../../resources/js/lib/app.ts"],"sourcesContent":["type GetType<T, Q> = (sender: T) => Q;\r\ntype SetType<T, Q> = (sender: T, value: any | ((value: Q) => Q)) => void;\r\ntype SetValue<T> = T extends any ? T | (() => T) : boolean;\r\n\r\nexport function createPrivateField<T extends {}, Q extends unknown = unknown>(\r\n  initialValue?: Q\r\n): [GetType<T, Q>, SetType<T, Q>] {\r\n  const fields = new WeakMap<T, Q>();\r\n\r\n  const get = (sender: T): Q => {\r\n    if (!fields.has(sender)) {\r\n      let value: any =\r\n        typeof initialValue === \"function\" ? initialValue() : initialValue;\r\n      if (Array.isArray(value)) {\r\n        value = [...value];\r\n      } else if (typeof value === \"object\") {\r\n        value = { ...value };\r\n      }\r\n      fields.set(sender, value);\r\n    }\r\n    return fields.get(sender) as Q;\r\n  };\r\n\r\n  const set = (sender: T, value: SetValue<Q>): void => {\r\n    if (typeof value === \"function\") {\r\n      fields.set(sender, value(get(sender)));\r\n    } else {\r\n      fields.set(sender, value as Q);\r\n    }\r\n  };\r\n\r\n  const out: [GetType<T, Q>, SetType<T, Q>] = [get, set];\r\n\r\n  return out;\r\n}\r\n","import { createPrivateField } from \"@/lib/private\"\r\n\r\nconst [active, setActive] = createPrivateField<EventDispatcher, boolean>(true)\r\nconst [events, setEvents] = createPrivateField<\r\n\tEventDispatcher,\r\n\tEventListen[]\r\n>([])\r\n\r\ntype EventListen<Args extends {} = {}> = (params: { [name in keyof Args]?: Args[name] }) => void\r\n\r\nexport class EventDispatcher<Args extends {} = {}> {\r\n\tconstructor(public name: string, public sender: any) {\r\n\t\tsetActive(this, true)\r\n\t\tsetEvents(this, [])\r\n\t}\r\n\r\n\tlisten(callback: EventListen<Args>) {\r\n\t\tsetEvents(this, (events: EventListen<Args>[]) => {\r\n\t\t\tevents.push(callback)\r\n            return events\r\n\t\t})\r\n\t}\r\n\r\n\tdispatch(params: { [name in keyof Args]?: Args[name] } = {}) {\r\n\t\tif (active(this)) {\r\n\t\t\tevents(this).forEach((callback: EventListen<Args>) => {\r\n\t\t\t\tcallback(params)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tactivate() {\r\n\t\tsetActive(this, true)\r\n\t}\r\n\r\n\tdeactivate() {\r\n\t\tsetActive(this, false)\r\n\t}\r\n}\r\n","import { EventDispatcher } from \"@/lib/event-dispatcher\";\r\n\r\nexport class Base<Events extends {} = {}> {\r\n  events: Events;\r\n\r\n  constructor(private _baseName?: string) {\r\n    if (!_baseName) {\r\n      this._baseName = this.constructor.name;\r\n    }\r\n    this.events = this.defineEvents();\r\n    this.init();\r\n  }\r\n\r\n  init() {}\r\n\r\n  get className(): string {\r\n    return this._baseName as string;\r\n  }\r\n\r\n  protected set className(name: string) {\r\n    this._baseName = name;\r\n  }\r\n\r\n  protected defineEvents(): Events {\r\n    return new Proxy<Events>({} as Events, {\r\n      get: (target: any, property: string, receiver: any) => {\r\n        if (!target.hasOwnProperty(property)) {\r\n          Reflect.set(\r\n            target,\r\n            property,\r\n            new EventDispatcher(property, this),\r\n            receiver\r\n          );\r\n        }\r\n        return Reflect.get(target, property, receiver);\r\n      },\r\n    });\r\n  }\r\n}\r\n","import { createPinia } from \"pinia\";\r\n\r\nexport const pinia = createPinia();\r\n","import { EventDispatcher } from \"@/lib/event-dispatcher\";\r\nimport { Base } from \"@/lib/base\";\r\nimport { pinia } from \"@/lib/pinia\";\r\nimport {\r\n  App as VueApp,\r\n  ComponentPublicInstance,\r\n  createApp as createVueApp,\r\n} from \"vue\";\r\n\r\ndeclare var window: any;\r\n\r\nwindow.codendot = window.codendot ?? {};\r\nwindow.codendot.vueApps = window.codendot.vueApps ?? {}; \r\n\r\ntype Events = {\r\n  init: EventDispatcher<{sender: Application}>;\r\n  start: EventDispatcher<{sender: Application}>;\r\n  mount: EventDispatcher<{sender: Application, vue: VueApp<Element>}>;\r\n  mounted: EventDispatcher<{sender: Application, vue: VueApp<Element>}>;\r\n};\r\n\r\nclass Application extends Base<Events> {\r\n  constructor(public name: string, public component: any) {\r\n    super(\"@/lib/Application\");\r\n  }\r\n\r\n  mount() {\r\n    this.events.init.dispatch({ sender: this });\r\n\r\n    window.codendot.vueApps[this.name] = (\r\n      id: string,\r\n      params: { [name: string]: any }\r\n    ): Promise<VueApp<Element>> => {\r\n      return new Promise((resolve) => {\r\n        this.events.start.dispatch({ sender: this });\r\n\r\n        const app: VueApp<Element> = createVueApp(this.component, params);\r\n\r\n        app.config.globalProperties.$params = params;\r\n\r\n        app.provide(\"app\", app);\r\n\r\n        // On Warning\r\n        app.config.warnHandler = (\r\n          msg: string,\r\n          instance: ComponentPublicInstance | null,\r\n          trace: string\r\n        ) => {\r\n          // warnInfo(msg, instance, trace)\r\n          console.warn(msg, instance, trace)\r\n        };\r\n\r\n        // On Error\r\n        app.config.errorHandler = (\r\n          err: any,\r\n          instance: ComponentPublicInstance | null,\r\n          info: string\r\n        ) => {\r\n          // errorInfo(err, instance, info)\r\n          console.error(err, instance, info)\r\n        };\r\n\r\n        app.use(pinia);\r\n\r\n        this.events.mount.dispatch({ vue: app, sender: this });\r\n\r\n        app.mount(`#${id}`);\r\n\r\n        this.events.mounted.dispatch({ vue: app, sender: this });\r\n\r\n        resolve(app);\r\n      });\r\n    };\r\n  }\r\n}\r\n\r\nexport type App = InstanceType<typeof Application>;\r\n\r\nexport const createApp = (name: string, component: any) => {\r\n  return new Application(name, component);\r\n};\r\n"],"names":["createPrivateField","initialValue","fields","get","sender","value","active","setActive","events","setEvents","EventDispatcher","name","callback","params","Base","_baseName","__publicField","target","property","receiver","pinia","createPinia","Application","component","id","resolve","app","createVueApp","msg","instance","trace","err","info","createApp"],"mappings":"8PAIO,SAASA,EACdC,EACgC,CAC1B,MAAAC,MAAa,QAEbC,EAAOC,GAAiB,CAC5B,GAAI,CAACF,EAAO,IAAIE,CAAM,EAAG,CACvB,IAAIC,EACF,OAAOJ,GAAiB,WAAaA,IAAiBA,EACpD,MAAM,QAAQI,CAAK,EACbA,EAAA,CAAC,GAAGA,CAAK,EACR,OAAOA,GAAU,WAClBA,EAAA,CAAE,GAAGA,IAERH,EAAA,IAAIE,EAAQC,CAAK,CAC1B,CACO,OAAAH,EAAO,IAAIE,CAAM,CAAA,EAanB,MAFqC,CAACD,EARjC,CAACC,EAAWC,IAA6B,CAC/C,OAAOA,GAAU,WACnBH,EAAO,IAAIE,EAAQC,EAAMF,EAAIC,CAAM,CAAC,CAAC,EAE9BF,EAAA,IAAIE,EAAQC,CAAU,CAC/B,CAGmD,CAGvD,CChCA,KAAM,CAACC,EAAQC,CAAS,EAAIP,EAA6C,EAAI,EACvE,CAACQ,EAAQC,CAAS,EAAIT,EAG1B,CAAE,CAAA,EAIG,MAAMU,CAAsC,CAClD,YAAmBC,EAAqBP,EAAa,CAAlC,KAAA,KAAAO,EAAqB,KAAA,OAAAP,EACvCG,EAAU,KAAM,EAAI,EACVE,EAAA,KAAM,CAAA,CAAE,CACnB,CAEA,OAAOG,EAA6B,CACzBH,EAAA,KAAOD,IAChBA,EAAO,KAAKI,CAAQ,EACJJ,EAChB,CACF,CAEA,SAASK,EAAgD,GAAI,CACxDP,EAAO,IAAI,GACdE,EAAO,IAAI,EAAE,QAASI,GAAgC,CACrDA,EAASC,CAAM,CAAA,CACf,CAEH,CAEA,UAAW,CACVN,EAAU,KAAM,EAAI,CACrB,CAEA,YAAa,CACZA,EAAU,KAAM,EAAK,CACtB,CACD,CCpCO,MAAMO,CAA6B,CAGxC,YAAoBC,EAAoB,CAFxCC,EAAA,eAEoB,KAAA,UAAAD,EACbA,IACE,KAAA,UAAY,KAAK,YAAY,MAE/B,KAAA,OAAS,KAAK,eACnB,KAAK,KAAK,CACZ,CAEA,MAAO,CAAC,CAER,IAAI,WAAoB,CACtB,OAAO,KAAK,SACd,CAEA,IAAc,UAAUJ,EAAc,CACpC,KAAK,UAAYA,CACnB,CAEU,cAAuB,CACxB,OAAA,IAAI,MAAc,GAAc,CACrC,IAAK,CAACM,EAAaC,EAAkBC,KAC9BF,EAAO,eAAeC,CAAQ,GACzB,QAAA,IACND,EACAC,EACA,IAAIR,EAAgBQ,EAAU,IAAI,EAClCC,CAAA,EAGG,QAAQ,IAAIF,EAAQC,EAAUC,CAAQ,EAC/C,CACD,CACH,CACF,CCpCO,MAAMC,EAAQC,EAAY,ECSjC,OAAO,SAAW,OAAO,UAAY,GACrC,OAAO,SAAS,QAAU,OAAO,SAAS,SAAW,CAAA,EASrD,MAAMC,UAAoBR,CAAa,CACrC,YAAmBH,EAAqBY,EAAgB,CACtD,MAAM,mBAAmB,EADR,KAAA,KAAAZ,EAAqB,KAAA,UAAAY,CAExC,CAEA,OAAQ,CACN,KAAK,OAAO,KAAK,SAAS,CAAE,OAAQ,KAAM,EAE1C,OAAO,SAAS,QAAQ,KAAK,IAAI,EAAI,CACnCC,EACAX,IAEO,IAAI,QAASY,GAAY,CAC9B,KAAK,OAAO,MAAM,SAAS,CAAE,OAAQ,KAAM,EAE3C,MAAMC,EAAuBC,EAAa,KAAK,UAAWd,CAAM,EAE5Da,EAAA,OAAO,iBAAiB,QAAUb,EAElCa,EAAA,QAAQ,MAAOA,CAAG,EAGtBA,EAAI,OAAO,YAAc,CACvBE,EACAC,EACAC,IACG,CAEK,QAAA,KAAKF,EAAKC,EAAUC,CAAK,CAAA,EAInCJ,EAAI,OAAO,aAAe,CACxBK,EACAF,EACAG,IACG,CAEK,QAAA,MAAMD,EAAKF,EAAUG,CAAI,CAAA,EAGnCN,EAAI,IAAIN,CAAK,EAER,KAAA,OAAO,MAAM,SAAS,CAAE,IAAKM,EAAK,OAAQ,KAAM,EAEjDA,EAAA,MAAM,IAAIF,CAAE,EAAE,EAEb,KAAA,OAAO,QAAQ,SAAS,CAAE,IAAKE,EAAK,OAAQ,KAAM,EAEvDD,EAAQC,CAAG,CAAA,CACZ,CAEL,CACF,CAIa,MAAAO,EAAY,CAACtB,EAAcY,IAC/B,IAAID,EAAYX,EAAMY,CAAS"}